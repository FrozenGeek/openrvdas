<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Alucia Widget Example</title>

    <style type="text/css">
      .ship_table {
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }
      .ship_table td, .ship_table th {
        border: 1px solid #ddd;
        padding: 8px;
      }
      .td_70 {
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        text-align: left;
        width: 70%;
      }
      .td_50 {
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        text-align: left;
        width: 50%;
      }
      .td_30 {
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        text-align: left;
        width: 30%;
      }
      .name_td {
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        text-align: left;
        width: 30%;
      }
      .val_td {
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        text-align: left;
        font-weight: bold;
        width: 20%;
      }
    </style>
  </head>
  <body>
    <!-- This is where we define location of data server. -->
    <script src="/static/js/widgets/settings.js"></script>

    <script src="/static/js/jquery/jquery-3.1.1.min.js"></script>
    <script src="/static/js/highcharts/code/highstock.js"></script>
    <script src="/static/js/highcharts/code/highcharts-more.js"></script>
    <script src="/static/js/highcharts/code/modules/data.js"></script>
    <script src="/static/js/highcharts/code/modules/exporting.js"></script>
    <script src="/static/js/highcharts/code/modules/export-data.js"></script>

    <script src="/static/js/widgets/highcharts_widget.js"></script>
    <script src="/static/js/widgets/text_widget.js"></script>
    <script src="/static/js/widgets/widget_server.js"></script>

    <table class="ship_table">
      <tr>
        <td>
      <table class="ship_table">
      <tr>
        <td colspan=2 class="td_50">
          <div id="rel_wind_dial" style="min-width: 100px"></div>
        </td>
        <td colspan=2 class="td_50">
          <div id="true_wind_dial" style="min-width: 100px"></div>
        </td>
        <td colspan=2 class="td_50">
          <div id="wind_speed_line" style="min-width: 100px;  height: 250px;"></div>
          <div id="barometer_line" style="min-width: 100px; height: 250px;"></div>
        </td>

      </tr>
      <tr>
        <td class="name_td" style="color:green">Ship Speed</td>
        <td class="val_td"><span id="ship_speed">missing</span>kt</td>
        <td class="name_td" style="color:blue">Rel Wind Speed</td>
        <td class="val_td"><span id="rel_wind_speed"></span> kt</td>
      </tr>
      <tr>
        <td class="name_td" style="color:green">Ship Course</td>
        <td class="val_td"><span id="ship_course"></span>째 T</td>
        <td class="name_td" style="color:blue">Rel Wind Dir</td>
        <td class="val_td"><span id="rel_wind_dir"></span>째 M</td>
      </tr>

      <tr>
        <td class="name_td">Lat</td>
        <td class="val_td">
          <span id="gps_lat"></span>째
          <span id="gps_n_or_s"></span>
        </td>
        <td class="name_td" style="color:blue">Air Temp</td>
        <td class="val_td"><span id="air_temp"></span></td>
      </tr>
      <tr>
        <td class="name_td">Lon</td>
        <td class="val_td">
          <span id="gps_lon"></span>째
          <span id="gps_e_or_w"></span>
        </td>
        <td class="name_td" style="color:blue">Rel. Humidity</td>
        <td class="val_td"><span id="rel_humid"></span> %</td>
      </tr>
      <tr>
        <td class="name_td" style="color:blue">Water Temp</td>
        <td class="val_td"><span id="sea_temp"></span></td>
        <td class="name_td" style="color:blue">Barometer</td>
        <td class="val_td"><span id="barometer"></span> mB</td>
      </tr>
      <tr>
        <td class="td_50" colspan=2>
          <div id="sea_temp_line" style="min-width: 100px;  height: 250px;"></div>
        </td> 
        <!-- <td class="name_td" style="color:blue">Fluorometer</td> -->
        <td class="val_td" colspan="2">Fluorometer: <span id="fluorometer"></span> counts
        <div id="flurometer_line" style="min-width: 100px; height: 250px;"></div>
        </td>
      </tr>
          </table>
        </td>
      </tr>
    </table>


  <script type="text/javascript">
  var widget_list = [];

  //////////////////
  // A dial
  var rel_wind_dial_fields = {
    AvgWindDir: {
      name: 'Relative Wind Dir',
      color: 'red',
    }
  };


  widget_list.push(new DialWidget('rel_wind_dial', rel_wind_dial_fields,
                                {title:{text:'Relative Wind Direction'}}
                                ));

  var true_wind_dial_fields = {
    TrueWindDir: {
      name: 'Relative Wind Dir',
      color: 'green',
    }
  };


  widget_list.push(new DialWidget('true_wind_dial', true_wind_dial_fields,
                                {title:{text:'True Wind Direction'}}
                                ));
  widget_list.push(new TextWidget('rel_wind_dir',
                               { AvgWindDir: {name: 'Rel Wind Dir'}}));

  widget_list.push(new TextWidget('rel_wind_speed',
                               { AvgWindSpeed: {name: 'Rel Wind Speed'}}));

  var rel_wind_line_fields = {
    AvgWindSpeed: {
      name: 'Relative Wind Speed',
      seconds: 3600,
      color: 'red',
    }
  };
  widget_list.push(new TimelineWidget('wind_speed_line', rel_wind_line_fields,
                                    'Knots', {title:{text:''}}
                                   ));

  var barometer_line_fields = {
    Pressure: {
      name: 'Barometric Pressure',
      seconds: 43200,
      color: 'blue',
    }
  };
  widget_list.push(new TimelineWidget('barometer_line', barometer_line_fields,
                                    'mBar', {title:{text:'Past Hour'}}
                                   ));

//{"type": "fields", "status": 200, "data": ["AvgWindDir", "AvgWindSpeed", "MaxWindSpeed", "AirTemp", "RH", "Pressure", "RainAccumulation", "RainIntensity", "CNAVGPSTime", "CNAVGPSDay", "CNAVGPSMonth", "CNAVGPSYear", "CNAVLocalHours", "CNAVLatitude", "CNAVNorS", "CNAVLongitude", "CNAVEorW", "CNAVFixQuality", "CNAVNumSats", "CNAVHDOP", "CNAVAntennaHeight", "CNAVGeoidHeight", "CNAVLastDGPSUpdate", "CNAVDGPSStationID", "CNAVCourseTrue", "CNAVSpeedKt", "CNAVSpeedKm", "CNAVMode", "status:cruise_definition", "status:logger_status", "FlowthroughTemp", "Conductivity", "Salinity", "SoundVelocity"]}
  widget_list.push(new TextWidget('gps_lat',
                                  {CNAVLatitude:
                                    {
                                      name: "CNAVLatitude",
                                      transform: function(val) {
                                        //return Math.round(val*100)/10000;
                                        //lat is actual in DDMM.mmmm format so we have to transform it
                                      lat = Math.round(val*100)/10000;
                                      latdeg = Math.floor(lat);
                                      latmin = (lat - Math.floor(lat)) * 100;
                                      lat = latdeg + (latmin / 60);
                                      return lat.toFixed(5);
                                      }
                                    }
                                  }));
  widget_list.push(new TextWidget('gps_n_or_s', {CNAVNorS: {name: "N/S"}}));

  widget_list.push(new TextWidget('gps_lon',
                                  {CNAVLongitude:
                                    {
                                      name: "CNAVLongitude",
                                      transform: function(val) {
                                      //lon is actual in DDMM.mmmm format so we have to transform it
                                      lon = Math.round(val*100)/10000;
                                      londeg = Math.floor(lon);
                                      lonmin = (lon - Math.floor(lon)) * 100;
                                      lon = londeg + (lonmin / 60);
                                      return lon.toFixed(5);
                                      }
                                    }
                                  }));
  widget_list.push(new TextWidget('gps_e_or_w', {CNAVEorW: {name: "E/W"}}));
widget_list.push(new TextWidget('ship_speed', {CNAVSpeedKt: {name: "Speed"}}));
widget_list.push(new TextWidget('ship_course', {CNAVCourseTrue: {name: "Course"}}));
widget_list.push(new TextWidget('air_temp', {AirTemp: {name: "Air Temp",
                                       transform: function(val) {
                                      //show C and F
                                      tempc = parseFloat(val);
                                      tempf = tempc * 9 / 5 + 32;
                                      return (tempc.toFixed(1) + " C / " + tempf.toFixed(1) + " F");
                                      }
}}));
widget_list.push(new TextWidget('rel_humid', {RH: {name: "RH"}}));
widget_list.push(new TextWidget('barometer', {Pressure: {name: "Barometer"}}));
widget_list.push(new TextWidget('fluorometer', {FluorometerSignalCounts: {name: "Fluoro Counts"}}));

  var fluorometer_line_fields = {
    FluorometerSignalCounts: {
      name: ' Fluorometer Counts',
      seconds: 3600,
      color: 'green',
    }
  };
  widget_list.push(new TimelineWidget('flurometer_line', fluorometer_line_fields,
                                    'counts', {title:{text:'Past 60min'}}
                                   ));


widget_list.push(new TextWidget('sea_temp', {SBE48Temp: {
                                                name: "Sea Temp",
                                                transform: function(val) {
                                      //lon is actual in DDMM.mmmm format so we have to transform it
                                      tempc = val;
                                      tempf = tempc * 9 / 5 + 32;
                                      return (tempc.toFixed(1) + " C / " + tempf.toFixed(1) + " F");
                                      }
                                      }}));

  var sea_temp_line_fields = {
    SBE48Temp: {
      name: 'Sea Temp',
      seconds: 3600,
      color: 'blue',
    }
  };
  widget_list.push(new TimelineWidget('sea_temp_line', sea_temp_line_fields,
                                    'C', {title:{text:'SBE48 Temp - Past Hour'}}
                                   ));
  var widget_server = new WidgetServer(widget_list, WEBSOCKET_DATA_SERVER);
  widget_server.serve();
</script>
</body>
</html>
